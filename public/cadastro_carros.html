<!doctype html>
<html lang="pt-br">

<head>
    <script src="/dmxAppConnect/dmxAppConnect.js"></script>
    <base href="/">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cadastro de Ve√≠culos</title>
    <link rel="stylesheet" href="/css/cadastro_carros.css">
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@600;800;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css" />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" />
    <script src="/dmxAppConnect/dmxStateManagement/dmxStateManagement.js" defer></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxNotifications/dmxNotifications.css" />
    <script src="/dmxAppConnect/dmxNotifications/dmxNotifications.js" defer></script>
    <script src="/dmxAppConnect/dmxBrowser/dmxBrowser.js" defer></script>
    <script src="/dmxAppConnect/dmxFormatter/dmxFormatter.js" defer></script>
</head>

<body is="dmx-app" id="cadastro_carros">
    <div is="dmx-browser" id="browser1"></div>
    <dmx-notifications id="notifies1" align="center"></dmx-notifications>
    <dmx-serverconnect id="obterCarro" url="/api/cadastroCarros/obterCarro" dmx-param:id_carro="query.id"></dmx-serverconnect>
    <dmx-query-manager id="query1"></dmx-query-manager>

    <style>
        /* grid igual ao seu two-cols, mas com bot√µes */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(190px, 1fr));
            gap: 10px 14px;
        }

        .options-grid .opt {
            display: contents;
        }

        /* permite o bot√£o ocupar a c√©lula toda */

        .opt-btn {
            height: 62px;
            width: 85%;
            border: 3px solid #cfd2d5;
            border-radius: 12px;
            padding: 12px 12px;
            font: 800 14px/1 "Montserrat", system-ui;
            text-transform: uppercase;
            color: #ffffff;
            background: #44484d;
            /* OFF */
            cursor: pointer;
            transition: transform .08s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
        }

        .opt-btn:hover {
            transform: translateY(-1px);
        }

        .opt-btn:active {
            transform: translateY(0);
        }

        /* estado ON (selecionado) */
        .opt-btn.active {
            background: #2e53a3ff;
            /* verde ON */
            border-color: #ffffffff;
            box-shadow: 0 0 0 3px rgba(39, 176, 255, 0.25);
        }


        .servicos-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(190px, 1fr));
            gap: 10px 14px;
        }

        /* Deixa o bot√£o ocupar a c√©lula inteira do grid */
        .servicos-grid .servui-option {
            display: contents;
        }

        /* Bot√£o de servi√ßo */
        .servui-btn {
            height: 62px;
            width: 85%;
            border: 3px solid #cfd2d5;
            border-radius: 12px;
            padding: 10px 12px;
            font: 800 14px/1 "Montserrat", system-ui;
            text-transform: uppercase;
            color: #fff;
            background: #44484d;
            /* estado OFF */
            cursor: pointer;
            transition: transform .08s ease,
                background .15s ease,
                border-color .15s ease,
                box-shadow .15s ease;
        }

        .servui-btn:hover {
            transform: translateY(-1px);
        }

        /* Estado ON (selecionado) */
        .servui-btn.active {
            background: #b4130eff;
            /* verde */
            border-color: #ffffffff;
            box-shadow: 0 0 0 3px rgba(236, 13, 13, 0.25);
        }

        /* Variante de alerta, se quiser marcar um bot√£o espec√≠fico com data-variant="danger" */
        .servui-btn.active[data-variant="danger"] {
            background: #ef4444;
            border-color: #c53030;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, .25);
        }

        /* variantes r√°pidas por data-variant, se quiser outra cor por item */
        /* .opt-btn[data-variant="danger"].active{ background:#ef4444; border-color:#c53030; box-shadow:0 0 0 3px rgba(239,68,68,.25);} */
    </style>

    <form class="page" id="dadosVeiculo" is="dmx-serverconnect-form" method="post" action="/api/cadastroCarros/decisaoEditarCriarCarros" autocomplete="off" dmx-on:success="notifies1.success('cadastro conclu√≠do!');browser1.goto('/lista_carros.html')">

        <div class="esquerda">
            <!-- LADO ESQUERDO -->
            <aside class="left-pane">
                <figure class="photo-card">
                    <img src="imgs/car-placeholder.png" alt="Foto do ve√≠culo">
                    <figcaption>Foto do ve√≠culo</figcaption>
                </figure>

                <div class="car-title">
                    <strong>CAR NAME (BMW)</strong>
                    <span>ANO 24 HEISEI</span>
                </div>

                <div class="price-box"><span class="price">3.500.000¬•</span></div>

                <div class="actions">
                    <button class="ghost" dmx-on:click="dadosVeiculo.submit()">Ôºã NOVO (F1)</button>
                    <button class="ghost">‚úé EDITAR (F2)</button>
                    <button class="ghost" dmx-on:click="dadosVeiculo.submit()">‚ñÆ SALVAR (F5)</button>
                    <button class="danger">üóë DELETAR</button>
                </div>
            </aside>

        </div>


        <div class="centro">
            <!-- CENTRO: TPageControl -->
            <main class="center-pane">
                <nav class="tabs" role="tablist" aria-label="Se√ß√µes do ve√≠culo">
                    <button class="item tab-btn active" role="tab" aria-selected="true" data-tab-target="#tab-dados">Dados Ve√≠culos</button>
                    <button class="item tab-btn" role="tab" aria-selected="false" data-tab-target="#tab-opcionais">Opcionais Ve√≠culo</button>
                    <button class="item tab-btn" role="tab" aria-selected="false" data-tab-target="#tab-servicos">Servi√ßos Realizados</button>
                    <button class="item tab-btn" role="tab" aria-selected="false" data-tab-target="#tab-historico">Hist√≥rico Placas</button>
                </nav>
                <div class="tab-panels">
                    <!-- ABA 1 -->
                    <div class="tab-panel active" id="tab-dados" role="tabpanel">
                        <div class="grid-form">
                            <input id="id_hidden" name="id_hidden" type="hidden" class="form-control d-print-none" dmx-bind:value="query.id">

                            <label>Marca
                                <input type="text" id="marca" name="marca" dmx-bind:value="obterCarro.data.query[0].marca">
                            </label>
                            <label>Modelo
                                <input type="text" id="model" name="model" dmx-bind:value="obterCarro.data.query[0].model">
                            </label>

                            <label>Cor
                                <input type="text" id="cor" name="cor" dmx-bind:value="obterCarro.data.query[0].cor">
                            </label>
                            <label>Ano de fabrica√ß√£o
                                <div class="composite-input-group composite-inline">
                                    <select id="anoFabricacaoEra" name="ano_fabricacao_era" dmx-bind:value="obterCarro.data.query[0].AnoJap">
                                        <option value="">Era</option>
                                        <option value="REIWA">REIWA</option>
                                        <option value="HEISEI">HEISEI</option>
                                        <option value="SHOWA">SHOWA</option>
                                    </select>
                                    <input type="text" id="anoFabricacaoAno" name="ano_fabricacao_ano" placeholder="Ano" dmx-bind:value="obterCarro.data.query[0].ano_year">
                                    <select id="anoFabricacaoMes" name="ano_fabricacao_mes" dmx-bind:value="obterCarro.data.query[0].mes">
                                        <option value="">M√™s</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                </div>
                            </label>

                            <label>KM Rodados
                                <input type="number" id="km" name="km" min="0" dmx-bind:value="obterCarro.data.query[0].km">
                            </label>
                            <label>Cilindrada
                                <input type="text" id="cilindrada" name="cilindrada" dmx-bind:value="obterCarro.data.query[0].cilindrada">
                            </label>
                            <label>Chassi
                                <input type="text" id="chassis" name="chassis" dmx-bind:value="obterCarro.data.query[0].chassis">
                            </label>

                            <label>Motor
                                <input type="text" id="motor" name="motor" dmx-bind:value="obterCarro.data.query[0].motor">
                            </label>
                            <label>N√∫mero Modelo
                                <input type="text" id="n_modelo" name="n_modelo" dmx-bind:value="obterCarro.data.query[0].n_modelo">
                            </label>
                            <label>Tra√ß√£o
                                <input type="text" id="tracao" name="tracao" dmx-bind:value="obterCarro.data.query[0].tracao">
                            </label>

                            <label>Transmiss√£o
                                <input type="text" id="transmissao" name="transmissao" dmx-bind:value="obterCarro.data.query[0].transmissao">
                            </label>
                            <label>Combust√≠vel
                                <input type="text" id="combustivel" name="combustivel" dmx-bind:value="obterCarro.data.query[0].combustivel">
                            </label>
                            <label>Tipo Ve√≠culo
                                <input type="text" id="tipo" name="tipo" dmx-bind:value="obterCarro.data.query[0].tipo">
                            </label>

                            <label>Portas
                                <input type="number" min="0" id="portas" name="portas" dmx-bind:value="obterCarro.data.query[0].portas">
                            </label>
                            <label>Pessoas
                                <input type="number" min="0" id="pessoas" name="pessoas" dmx-bind:value="obterCarro.data.query[0].pessoas">
                            </label>
                            <label>Peso
                                <input type="text" id="peso" name="peso" dmx-bind:value="obterCarro.data.query[0].peso">
                            </label>

                            <label>Carga
                                <input type="text" id="carga" name="carga" dmx-bind:value="obterCarro.data.query[0].carga">
                            </label>
                            <label>Fornecedor
                                <input type="text" id="fornecedor" name="fornecedor" dmx-bind:value="obterCarro.data.query[0].fornecedor">
                            </label>
                            <label>Status
                                <select id="status" name="status" dmx-bind:value="obterCarro.data.query[0].status">
                                    <option value="">Selecione</option>
                                    <option value="Dispon√≠vel">Dispon√≠vel</option>
                                    <option value="Reservado">Reservado</option>
                                    <option value="Vendido">Vendido</option>
                                    <option value="Em preparo">Em preparo</option>
                                </select>
                            </label>

                            <label>Pre√ßo de Custo (¬•)
                                <input type="number" min="0" id="custo" name="custo" dmx-bind:value="obterCarro.data.query[0].custo">
                            </label>
                            <label>Pre√ßo de Venda (¬•)
                                <input type="number" min="0" id="venda" name="venda" dmx-bind:value="obterCarro.data.query[0].venda">
                            </label>
                            <label>Cliente
                                <input type="text" id="cliente" name="cliente" dmx-bind:value="obterCarro.data.query[0].cliente">
                            </label>

                            <label>Vistoria (Shaken)
                                <div class="composite-input-group composite-inline shaken-input-group">
                                    <select id="shakenEra" name="shaken_era" dmx-bind:value="obterCarro.data.query[0].shaken_jap">
                                        <option value="">Era</option>
                                        <option value="REIWA">REIWA</option>
                                        <option value="HEISEI">HEISEI</option>
                                        <option value="SHOWA">SHOWA</option>
                                    </select>
                                    <input type="text" id="shakenAnoEra" name="shaken_ano" placeholder="Ano" inputmode="numeric" dmx-bind:value="obterCarro.data.query[0].shaken_ano">
                                    <select id="shakenMes" name="shaken_mes" dmx-bind:value="obterCarro.data.query[0].shaken_mes">
                                        <option value="">M√™s</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                    <select id="shakenDia" name="shaken_day" dmx-bind:value="obterCarro.data.query[0].shaken_day">
                                        <option value="">Dia</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                        <option value="13">13</option>
                                        <option value="14">14</option>
                                        <option value="15">15</option>
                                        <option value="16">16</option>
                                        <option value="17">17</option>
                                        <option value="18">18</option>
                                        <option value="19">19</option>
                                        <option value="20">20</option>
                                        <option value="21">21</option>
                                        <option value="22">22</option>
                                        <option value="23">23</option>
                                        <option value="24">24</option>
                                        <option value="25">25</option>
                                        <option value="26">26</option>
                                        <option value="27">27</option>
                                        <option value="28">28</option>
                                        <option value="29">29</option>
                                        <option value="30">30</option>
                                        <option value="31">31</option>
                                    </select>
                                </div>
                            </label>

                            <div class="ghost-cell"></div>

                            <label class="full">Outros
                                <textarea rows="5" id="outros" name="outros" dmx-bind:value="obterCarro.data.query[0].outros"></textarea>
                            </label>
                        </div>
                    </div>

                    <!-- ABA 2 -->
                    <div class="tab-panel" id="tab-opcionais" role="tabpanel" aria-hidden="true">
                        <div class="pad two-cols options-grid" id="opcionais">
                            <!-- cada bot√£o tem um checkbox hidden pareado (mesmo valor) -->
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="ABS" id="ABS">ABS</button>
                                <input type="checkbox" id="opcionalABS" name="opcionais[]" value="1" data-label="ABS" hidden="" dmx-bind:checked="value.contains(obterCarro.data.query[0].opcionais)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Bancos el√©tricos" id="bancosEletricos">Bancos el√©tricos</button>
                                <input type="checkbox" id="opcionalBancosEletricos" name="opcionais[]" value="2" data-label="Bancos el√©tricos" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="ESC" id="ESC">ESC</button>
                                <input type="checkbox" id="opcionalESC" name="opcionais[]" value="3" data-label="ESC" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Key-Less" id="keyless">Key-Less</button>
                                <input type="checkbox" id="opcionalKeyless" name="opcionais[]" value="4" data-label="Key-Less" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Porta de correr" id="portaDeCorrer">Porta de correr</button>
                                <input type="checkbox" id="opcionalPortaDeCorrer" name="opcionais[]" value="5" data-label="Porta de correr" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Ve√≠culo especial" id="veiculoEspecial">Ve√≠culo especial</button>
                                <input type="checkbox" id="opcionalVeiculoEspecial" name="opcionais[]" value="6" data-label="Ve√≠culo especial" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Alarme" id="alarme">Alarme</button>
                                <input type="checkbox" id="opcionalAlarme" name="opcionais[]" value="7" data-label="Alarme" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Bancos de couro" id="bancosDeCouro">Bancos de couro</button>
                                <input type="checkbox" id="opcionalBancosDeCouro" name="opcionais[]" value="8" data-label="Bancos de couro" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="ETC" id="ETC">ETC</button>
                                <input type="checkbox" id="opcionalETC" name="opcionais[]" value="9" data-label="ETC" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Kit Aero" id="kitAero">Kit Aero</button>
                                <input type="checkbox" id="opcionalKitAero" name="opcionais[]" value="10" data-label="Kit Aero" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Rebaixado" id="rebaixado">Rebaixado</button>
                                <input type="checkbox" id="opcionalRebaixado" name="opcionais[]" value="11" data-label="Rebaixado" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Vidros el√©tricos" id="vidrosEletricos">Vidros el√©tricos</button>
                                <input type="checkbox" id="opcionalVidrosEletricos" name="opcionais[]" value="12" data-label="Vidros el√©tricos" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="AirBag" id="airbag">AirBag</button>
                                <input type="checkbox" id="opcionalAirbag" name="opcionais[]" value="13" data-label="AirBag" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Carro Novo" id="carroNovo">Carro Novo</button>
                                <input type="checkbox" id="opcionalCarroNovo" name="opcionais[]" value="14" data-label="Carro Novo" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Teto Solar" id="tetoSolar">Teto Solar</button>
                                <input type="checkbox" id="opcionalTetoSolar" name="opcionais[]" value="15" data-label="Teto Solar" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Manual do Propriet√°rio" id="manualDoProprietrio">Manual do Propriet√°rio</button>
                                <input type="checkbox" id="opcionalManualDoProprietrio" name="opcionais[]" value="16" data-label="Manual do Propriet√°rio" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Rodas de alum√≠nio" id="rodasDeAluminio">Rodas de alum√≠nio</button>
                                <input type="checkbox" id="opcionalRodasDeAluminio" name="opcionais[]" value="17" data-label="Rodas de alum√≠nio" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="3 Fileiras de Bancos" id="tresFileirasDeBancos">3 Fileiras de Bancos</button>
                                <input type="checkbox" id="opcionalTresFileirasDeBancos" name="opcionais[]" value="18" data-label="3 Fileiras de Bancos" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Corredor" id="corredor">Corredor</button>
                                <input type="checkbox" id="opcionalCorredor" name="opcionais[]" value="19" data-label="Corredor" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Far√≥is Xenom" id="faroisXenom">Far√≥is Xenom</button>
                                <input type="checkbox" id="opcionalFaroisXenom" name="opcionais[]" value="20" data-label="Far√≥is Xenom" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Monitor Traseiro" id="monitorTraseiro">Monitor Traseiro</button>
                                <input type="checkbox" id="opcionalMonitorTraseiro" name="opcionais[]" value="21" data-label="Monitor Traseiro" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Trava Autom√°tica" id="travaAutomatica">Trava Autom√°tica</button>
                                <input type="checkbox" id="opcionalTravaAutomatica" name="opcionais[]" value="22" data-label="Trava Autom√°tica" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="4WD" id="fourWD">4WD</button>
                                <input type="checkbox" id="opcionalFourWD" name="opcionais[]" value="23" data-label="4WD" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="CD-MD" id="cdmd">CD-MD</button>
                                <input type="checkbox" id="opcionalCdmd" name="opcionais[]" value="24" data-label="CD-MD" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Hist√≥rico de Tenken" id="historicoTenken">Hist√≥rico de Tenken</button>
                                <input type="checkbox" id="opcionalHistoricoTenken" name="opcionais[]" value="25" data-label="Hist√≥rico de Tenken" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="N√£o fumante" id="naoFumante">N√£o fumante</button>
                                <input type="checkbox" id="opcionalNaoFumante" name="opcionais[]" value="26" data-label="N√£o fumante" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Turbo" id="turbo">Turbo</button>
                                <input type="checkbox" id="opcionalTurbo" name="opcionais[]" value="27" data-label="Turbo" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="C√¢mera frontal" id="cameraFrontal">C√¢mera frontal</button>
                                <input type="checkbox" id="opcionalCameraFrontal" name="opcionais[]" value="28" data-label="C√¢mera frontal" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Banco Sof√°" id="bancoSofa">Banco Sof√°</button>
                                <input type="checkbox" id="opcionalBancoSofa" name="opcionais[]" value="29" data-label="Banco Sof√°" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Dire√ß√£o Hidr√°ulica" id="direcaoHidraulica">Dire√ß√£o Hidr√°ulica</button>
                                <input type="checkbox" id="opcionalDirecaoHidraulica" name="opcionais[]" value="30" data-label="Dire√ß√£o Hidr√°ulica" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Importados" id="importados">Importados</button>
                                <input type="checkbox" id="opcionalImportados" name="opcionais[]" value="31" data-label="Importados" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Navi-TV" id="naviTV">Navi-TV</button>
                                <input type="checkbox" id="opcionalNaviTV" name="opcionais[]" value="32" data-label="Navi-TV" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="√önico Dono" id="unicoDono">√önico Dono</button>
                                <input type="checkbox" id="opcionalUnicoDono" name="opcionais[]" value="33" data-label="√önico Dono" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="C√¢mera Traseira" id="cameraTraseira">C√¢mera Traseira</button>
                                <input type="checkbox" id="opcionalCameraTraseira" name="opcionais[]" value="34" data-label="C√¢mera Traseira" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Ar Condicionado" id="arCondicionado">Ar Condicionado</button>
                                <input type="checkbox" id="opcionalArCondicionado" name="opcionais[]" value="35" data-label="Ar Condicionado" hidden>
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Ar Condicionado Traseiro" id="arCondicionadoTraseiro">Ar Condicionado Traseiro</button>
                                <input type="checkbox" id="opcionalArCondicionadoTraseiro" name="opcionais[]" value="36" data-label="Ar Condicionado Traseiro" hidden>
                            </div>

                        </div>
                    </div>

                    <!-- ABA 3 -->
                    <div class="tab-panel" id="tab-servicos" role="tabpanel" aria-hidden="true">
                        <div class="pad two-cols servicos-grid" id="servicos">
                            <!-- Cada bloco: bot√£o vis√≠vel + checkbox hidden que envia no form -->
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Higieniza√ß√£o" id="higienizacao">Higieniza√ß√£o</button>
                                <input type="checkbox" id="servicoHigienizacao" name="servicos[]" value="1" data-label="Higieniza√ß√£o" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Polimento" id="polimento">Polimento</button>
                                <input type="checkbox" id="servicoPolimento" name="servicos[]" value="2" data-label="Polimento" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Cristaliza√ß√£o" id="cristalizacao">Cristaliza√ß√£o</button>
                                <input type="checkbox" id="servicoCristalizacao" name="servicos[]" value="3" data-label="Cristaliza√ß√£o" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Limpeza do ar condicionado" id="limpezaArCondicionado">Limpeza do ar condicionado</button>
                                <input type="checkbox" id="servicoLimpezaArCondicionado" name="servicos[]" value="4" data-label="Limpeza do ar condicionado" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de filtro do ar" id="trocaFiltroAr">Troca de filtro do ar</button>
                                <input type="checkbox" id="servicoTrocaFiltroAr" name="servicos[]" value="5" data-label="Troca de filtro do ar" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de √≥leo" id="trocaOleo">Troca de √≥leo</button>
                                <input type="checkbox" id="servicoTrocaOleo" name="servicos[]" value="6" data-label="Troca de √≥leo" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de filtro de √≥leo" id="trocaFiltroOleo">Troca de filtro de √≥leo</button>
                                <input type="checkbox" id="servicoTrocaFiltroOleo" name="servicos[]" value="7" data-label="Troca de filtro de √≥leo" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de filtro do combust√≠vel" id="trocaFiltroCombustivel">Troca de filtro do combust√≠vel</button>
                                <input type="checkbox" id="servicoTrocaFiltroCombustivel" name="servicos[]" value="8" data-label="Troca de filtro do combust√≠vel" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Alinhamento dos pneus" id="alinhamentoPneus">Alinhamento dos pneus</button>
                                <input type="checkbox" id="servicoAlinhamentoPneus" name="servicos[]" value="9" data-label="Alinhamento dos pneus" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de pneus" id="trocaPneus">Troca de pneus</button>
                                <input type="checkbox" id="servicoTrocaPneus" name="servicos[]" value="10" data-label="Troca de pneus" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca da buzina" id="trocaBuzina">Troca da buzina</button>
                                <input type="checkbox" id="servicoTrocaBuzina" name="servicos[]" value="11" data-label="Troca da buzina" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca dos cintos de seguran√ßa" id="trocaCintos">Troca dos cintos de seguran√ßa</button>
                                <input type="checkbox" id="servicoTrocaCintos" name="servicos[]" value="12" data-label="Troca dos cintos de seguran√ßa" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de embreagem" id="trocaEmbreagem">Troca de embreagem</button>
                                <input type="checkbox" id="servicoTrocaEmbreagem" name="servicos[]" value="13" data-label="Troca de embreagem" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de fluido da dire√ß√£o hidr√°ulica" id="trocaFluidoDirecao">Troca de fluido da dire√ß√£o hidr√°ulica</button>
                                <input type="checkbox" id="servicoTrocaFluidoDirecao" name="servicos[]" value="14" data-label="Troca de fluido da dire√ß√£o hidr√°ulica" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de fluido de freio" id="trocaFluidoFreio">Troca de fluido de freio</button>
                                <input type="checkbox" id="servicoTrocaFluidoFreio" name="servicos[]" value="15" data-label="Troca de fluido de freio" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de limpadores de parabrisas" id="trocaLimpadores">Troca de limpadores de parabrisa</button>
                                <input type="checkbox" id="servicoTrocaLimpadores" name="servicos[]" value="16" data-label="Troca de limpadores de parabrisas" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de bateria" id="trocaBateria">Troca de bateria</button>
                                <input type="checkbox" id="servicoTrocaBateria" name="servicos[]" value="17" data-label="Troca de bateria" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do sistema de freios" id="trocaSistemaFreios">Troca do sistema de freios</button>
                                <input type="checkbox" id="servicoTrocaSistemaFreios" name="servicos[]" value="18" data-label="Troca do sistema de freios" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do sistema de suspens√£o" id="trocaSistemaSuspensao">Troca do sistema de suspen√ß√£o</button>
                                <input type="checkbox" id="servicoTrocaSistemaSuspensao" name="servicos[]" value="19" data-label="Troca do sistema de suspens√£o" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de velas" id="trocaVelas">Troca de velas</button>
                                <input type="checkbox" id="servicoTrocaVelas" name="servicos[]" value="20" data-label="Troca de velas" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do l√≠quido de arrefecimento" id="trocaArrefecimento">Troca do l√≠quido de arrefecimento</button>
                                <input type="checkbox" id="servicoTrocaArrefecimento" name="servicos[]" value="21" data-label="Troca do l√≠quido de arrefecimento" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de fluido das transmiss√µes" id="trocaFluidoTransmissao">Troca de fluido das transmiss√µes</button>
                                <input type="checkbox" id="servicoTrocaFluidoTransmissao" name="servicos[]" value="22" data-label="Troca de fluido das transmiss√µes" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do filtro de cabine" id="trocaFiltroCabine">Troca do filtro de cabine</button>
                                <input type="checkbox" id="servicoTrocaFiltroCabine" name="servicos[]" value="23" data-label="Troca do filtro de cabine" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de correia poly-v" id="trocaCorreiaPolyv">Troca de correia poly-v</button>
                                <input type="checkbox" id="servicoTrocaCorreiaPolyv" name="servicos[]" value="24" data-label="Troca de correia poly-v" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de correia dentada" id="trocaCorreiaDentada">Troca de correia dentada</button>
                                <input type="checkbox" id="servicoTrocaCorreiaDentada" name="servicos[]" value="25" data-label="Troca de correia dentada" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Correia do compressor do ar condicionado" id="trocaCorreiaCompressor">Correia do compressor do ar condicionado</button>
                                <input type="checkbox" id="servicoTrocaCorreiaCompressor" name="servicos[]" value="26" data-label="Correia do compressor do ar condicionado" hidden>
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de correia do alternador" id="trocaCorreiaAlternador">Troca de correia do alternador</button>
                                <input type="checkbox" id="servicoTrocaCorreiaAlternador" name="servicos[]" value="27" data-label="Troca de correia do alternador" hidden>
                            </div>
                        </div>
                    </div>

                    <!-- ABA 4 -->
                    <div class="tab-panel" id="tab-historico" role="tabpanel" aria-hidden="true">
                        <div class="jp-plate-wrap">
                            <!-- Bot√£o visual da placa: clique alterna branca/amarela -->
                            <button type="button" class="jp-plate" id="jpPlate" aria-pressed="false" title="Clique para alternar: Futsuusha ‚Üî Keijid≈çsha">
                                <span class="plate-region" id="outRegion">Êù±‰∫¨</span>
                                <span class="plate-class" id="outClass">300</span>
                                <span class="plate-mark" id="outMark">„ÅÇ</span>
                                <span class="plate-number" id="outNumber"><span>12</span>-<span>34</span></span>
                                <span class="plate-type-badge" id="plateTypeBadge">ÊôÆÈÄöËªä</span>
                            </button>

                            <!-- Controles -->
                            <div class="jp-plate-controls">
                                <div class="row">
                                    <label>Regi√£o
                                        <input id="inRegion" name="placa_regiao" type="text" placeholder="ex.: Êù±‰∫¨">
                                    </label>
                                    <label>Classe
                                        <input id="inClass" name="placa_classe" type="text" placeholder="ex.: 300">
                                    </label>
                                    <label>Hiragana
                                        <input id="inMark" name="placa_hiragana" type="text" placeholder="ex.: „ÅÇ" maxlength="1">
                                    </label>
                                    <label>N√∫mero
                                        <input id="inNumber" name="placa_numero" type="text" placeholder="ex.: 1234" pattern="\d{4}" maxlength="4">
                                    </label>
                                </div>

                                <div class="actions">
                                    <button type="button" class="item2" id="btnApply">Aplicar na placa</button>
                                    <button type="button" class="item2" id="btnAddHistory">Adicionar ao hist√≥rico</button>
                                </div>
                            </div>


                            <!-- Hist√≥rico -->
                            <div class="jp-plate-history">
                                <div class="head">
                                    <strong>Hist√≥rico de placas</strong>
                                </div>
                                <ul id="plateHistory" class="list"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

        </div>

        <div class="direita">
            <!-- DIREITA: diagrama com pontos -->
            <aside class="right-pane">
                <div class="car-diagram">
                    <img src="/assets/images/diagram-car-top.png" alt="Diagrama do carro">
                    <!-- Ajuste as posi√ß√µes (%) conforme sua arte -->
                    <button class="dot" data-av="av1" style="--x:50%; --y:15%"></button>
                    <button class="dot" data-av="av2" style="--x:16%; --y:24%"></button>
                    <button class="dot" data-av="av3" style="--x:84%; --y:24%"></button>
                    <button class="dot" data-av="av4" style="--x:16%; --y:40%"></button>
                    <button class="dot" data-av="av5" style="--x:84%; --y:40%"></button>
                    <button class="dot" data-av="av6" style="--x:16%; --y:56%"></button>
                    <button class="dot" data-av="av7" style="--x:84%; --y:56%"></button>
                    <button class="dot" data-av="av8" style="--x:16%; --y:72%"></button>
                    <button class="dot" data-av="av9" style="--x:84%; --y:72%"></button>
                    <button class="dot" data-av="av10" style="--x:50%; --y:33%"></button>
                    <button class="dot" data-av="av11" style="--x:50%; --y:71%"></button>
                    <button class="dot" data-av="av12" style="--x:50%; --y:85%"></button>
                </div>
            </aside>

        </div>

    </form>

    <!-- JS: tabs + dots -->
    <script>
        const form = document.getElementById('dadosVeiculo');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const panels = document.querySelectorAll('.tab-panel');

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const tgt = document.querySelector(btn.dataset.tabTarget);
                tabButtons.forEach(b => {
                    const active = b === btn;
                    b.classList.toggle('active', active);
                    b.setAttribute('aria-selected', active ? 'true' : 'false');
                });
                panels.forEach(p => {
                    const active = (p === tgt);
                    p.classList.toggle('active', active);
                    p.toggleAttribute('aria-hidden', !active);
                });
            });
        });

        const getSelectedIds = selector => {
            if (!form) return [];
            return Array.from(form.querySelectorAll(selector))
                .map(el => Number(el.value))
                .filter(num => Number.isFinite(num));
        };

        const updateFeatures = () => {
            if (!form) return;
            const cmimgField = form.querySelector('#cmimg');
            if (!cmimgField) return;
            const opcionaisSel = getSelectedIds('#opcionais input[type=\"checkbox\"]:checked');
            const servicosSel = getSelectedIds('#servicos input[type=\"checkbox\"]:checked');
            cmimgField.value = JSON.stringify({ opcionais: opcionaisSel, servicos: servicosSel });
        };

        document.querySelectorAll('#opcionais .opt').forEach(w => {
            const btn = w.querySelector('.opt-btn');
            const chk = w.querySelector('input[type=\"checkbox\"]');
            if (!btn || !chk) return;
            if (chk.checked) btn.classList.add('active');
            btn.setAttribute('aria-pressed', chk.checked ? 'true' : 'false');
            btn.addEventListener('click', () => {
                const on = !chk.checked;
                chk.checked = on;
                btn.classList.toggle('active', on);
                btn.setAttribute('aria-pressed', on ? 'true' : 'false');
                updateFeatures();
            });
        });

        (function initServicos(){
            const wrap = document.getElementById('servicos');
            if (!wrap) return;
            wrap.querySelectorAll('.servui-option').forEach(opt => {
                const btn = opt.querySelector('.servui-btn');
                const chk = opt.querySelector('input[type=\"checkbox\"]');
                if (!btn || !chk) return;
                if (chk.checked) btn.classList.add('active');
                btn.setAttribute('aria-pressed', chk.checked ? 'true' : 'false');
                btn.addEventListener('click', () => {
                    const on = !chk.checked;
                    chk.checked = on;
                    btn.classList.toggle('active', on);
                    btn.setAttribute('aria-pressed', on ? 'true' : 'false');
                    updateFeatures();
                });
            });
        })();

        updateFeatures();

        const formatCurrency = value => {
            const num = Number(String(value).replace(/[^0-9.-]/g, ''));
            if (!value || Number.isNaN(num)) return '';
            return num.toLocaleString('ja-JP') + '¬•';
        };

        (function initComputed(){
            if (!form) return;
            const marca = form.querySelector('#marca');
            const modelo = form.querySelector('#model');
            const veiculo = form.querySelector('#veiculo');
            const custo = form.querySelector('#custo');
            const venda = form.querySelector('#venda');
            const custoVisual = form.querySelector('#custo_visual');
            const vendaVisual = form.querySelector('#venda_visual');
            const anoFabricacaoAno = form.querySelector('#anoFabricacaoAno');
            const anoFabricacaoMes = form.querySelector('#anoFabricacaoMes');
            const anoFabricacaoAnoHidden = form.querySelector('#anoFabricacaoAnoHidden');
            const anoFabricacaoMesHidden = form.querySelector('#anoFabricacaoMesHidden');
            const shakenEra = form.querySelector('#shakenEra');
            const shakenAno = form.querySelector('#shakenAnoEra');
            const shakenMes = form.querySelector('#shakenMes');
            const shakenDia = form.querySelector('#shakenDia');
            const shakenVisual = form.querySelector('#shaken_visual');
            const shakenEraHidden = form.querySelector('#shakenEraHidden');

            const syncVeiculo = () => {
                if (!veiculo) return;
                const parts = [marca?.value, modelo?.value].filter(Boolean);
                veiculo.value = parts.join(' ').trim();
            };
            [marca, modelo].forEach(el => el && el.addEventListener('input', syncVeiculo));
            syncVeiculo();

            const syncCurrency = () => {
                if (custo && custoVisual) custoVisual.value = formatCurrency(custo.value);
                if (venda && vendaVisual) vendaVisual.value = formatCurrency(venda.value);
            };
            [custo, venda].forEach(el => el && el.addEventListener('input', syncCurrency));
            syncCurrency();

            const syncFabricacaoHidden = () => {
                if (anoFabricacaoAnoHidden && anoFabricacaoAno) {
                    anoFabricacaoAnoHidden.value = anoFabricacaoAno.value;
                }
                if (anoFabricacaoMesHidden && anoFabricacaoMes) {
                    anoFabricacaoMesHidden.value = anoFabricacaoMes.value;
                }
            };
            [anoFabricacaoAno, anoFabricacaoMes].forEach(el => {
                if (!el) return;
                el.addEventListener('input', syncFabricacaoHidden);
                el.addEventListener('change', syncFabricacaoHidden);
            });
            syncFabricacaoHidden();

            const syncShakenHidden = () => {
                if (shakenEraHidden && shakenEra) {
                    shakenEraHidden.value = shakenEra.value;
                }
            };
            if (shakenEra) {
                shakenEra.addEventListener('input', syncShakenHidden);
                shakenEra.addEventListener('change', syncShakenHidden);
            }
            syncShakenHidden();

            const syncShakenVisual = () => {
                if (!shakenVisual) return;
                const ano = shakenAno?.value || '';
                const mes = shakenMes?.value || '';
                const dia = shakenDia?.value || '';
                const parts = [ano, mes, dia].filter(Boolean);
                shakenVisual.value = parts.join('/');
            };
            [shakenAno, shakenMes, shakenDia].forEach(el => {
                if (!el) return;
                el.addEventListener('input', syncShakenVisual);
                el.addEventListener('change', syncShakenVisual);
            });
            syncShakenVisual();
        })();

        (function initDots(){
            if (!form) return;
            document.querySelectorAll('.car-diagram .dot').forEach(dot => {
                const field = form.querySelector(`#${dot.dataset.av}`);
                const isAlert = field && field.value === 'Vermelho';
                dot.classList.toggle('alert', !!isAlert);
                dot.setAttribute('aria-pressed', isAlert ? 'true' : 'false');
                dot.addEventListener('click', () => {
                    const next = !dot.classList.contains('alert');
                    dot.classList.toggle('alert', next);
                    dot.setAttribute('aria-pressed', next ? 'true' : 'false');
                    if (field) field.value = next ? 'Vermelho' : 'Verde';
                });
            });
        })();

        (function placaJaponesa(){
            const plate   = document.getElementById('jpPlate');
            if (!plate) return;
            const badge   = document.getElementById('plateTypeBadge');

            const inRegion = document.getElementById('inRegion');
            const inClass  = document.getElementById('inClass');
            const inMark   = document.getElementById('inMark');
            const inNumber = document.getElementById('inNumber');

            const outRegion = document.getElementById('outRegion');
            const outClass  = document.getElementById('outClass');
            const outMark   = document.getElementById('outMark');
            const outNumber = document.getElementById('outNumber');

            const btnApply = document.getElementById('btnApply');
            const btnAdd   = document.getElementById('btnAddHistory');
            const list     = document.getElementById('plateHistory');
            const placaHidden = document.getElementById('placa');

            const syncPlacatype = () => {
                if (!placaHidden) return;
                placaHidden.value = plate.classList.contains('is-kei') ? 'Amarela' : 'Branca';
            };
            syncPlacatype();

            plate.addEventListener('click', (e) => {
                if (e.target.closest('.jp-plate-controls')) return;
                const isKei = plate.classList.toggle('is-kei');
                plate.setAttribute('aria-pressed', isKei ? 'true' : 'false');
                badge.textContent = isKei ? 'ËªΩËá™ÂãïËªä' : 'ÊôÆÈÄöËªä';
                syncPlacatype();
            });

            btnApply?.addEventListener('click', () => {
                const region = (inRegion?.value || outRegion.textContent).trim();
                const klass  = (inClass?.value  || outClass.textContent).trim();
                const mark   = (inMark?.value   || outMark.textContent).trim();
                const num    = (inNumber?.value || outNumber.textContent.replace('-', '')).trim();

                let numFmt = outNumber.innerHTML;
                if (/^\\d{4}$/.test(num)) {
                    numFmt = `<span>${num.slice(0,2)}</span>-<span>${num.slice(2)}</span>`;
                }

                outRegion.textContent = region || 'Êù±‰∫¨';
                outClass.textContent  = klass  || '300';
                outMark.textContent   = mark   || '„ÅÇ';
                outNumber.innerHTML   = numFmt;
                plate.animate([{filter:'brightness(1.2)'},{filter:'brightness(1)'}], {duration:180, easing:'ease-out'});
            });

            btnAdd?.addEventListener('click', () => {
                const isKei = plate.classList.contains('is-kei');
                const txt   = `${outRegion.textContent} ${outClass.textContent} ${outMark.textContent} ${outNumber.textContent.replace(/<[^>]*>/g,'')} ‚Äî ${isKei ? 'Keijid≈çsha (amarela)' : 'Futsuusha (branca)'}`;
                const li = document.createElement('li');
                li.textContent = txt;
                list?.prepend(li);
                li.animate([{opacity:0, transform:'translateY(-4px)'},{opacity:1, transform:'translateY(0)'}], {duration:160, easing:'ease-out'});
            });
        })();

        updateFeatures();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
</body>

</html>