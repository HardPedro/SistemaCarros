<!doctype html>
<html lang="pt-br">

<head>
    <script src="/dmxAppConnect/dmxAppConnect.js"></script>
    <base href="/">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cadastro de Veículos</title>
    <link rel="stylesheet" href="/css/cadastro_carros.css">
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@600;800;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css" />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" />
    <script src="/dmxAppConnect/dmxStateManagement/dmxStateManagement.js" defer></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxNotifications/dmxNotifications.css" />
    <script src="/dmxAppConnect/dmxNotifications/dmxNotifications.js" defer></script>
    <script src="/dmxAppConnect/dmxBrowser/dmxBrowser.js" defer></script>
    <script src="/dmxAppConnect/dmxFormatter/dmxFormatter.js" defer></script>
    <script src="/dmxAppConnect/dmxBootstrap4Modal/dmxBootstrap4Modal.js" defer></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxDropzone/dmxDropzone.css" />
    <script src="/dmxAppConnect/dmxDropzone/dmxDropzone.js" defer></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxValidator/dmxValidator.css" />
    <script src="/dmxAppConnect/dmxValidator/dmxValidator.js" defer></script>
    <script src="/dmxAppConnect/dmxSwiper/dmxSwiper.js" defer></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxSwiper/swiper.min.css" />
    <script src="/dmxAppConnect/dmxSwiper/swiper.min.js" defer></script>
    <script src="/dmxAppConnect/dmxMasonry/dmxMasonry.js" defer></script>
    <link rel="stylesheet" href="/dmxAppConnect/dmxMasonry/dmxMasonry.js" defer>
    </script>
    <style>
        .image-uploader {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-image-container {
            text-align: center;
        }

        .main-image-preview {
            max-width: 100%;
            max-height: 400px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .thumbnail-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }

        .thumbnail {
            flex: 0 0 150px;
            text-align: center;
        }

        .thumbnail-preview {
            width: 150px;
            height: 100px;
            object-fit: cover;
            border: 2px solid #ddd;
            border-radius: 5px;
            padding: 5px;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .thumbnail-preview:hover {
            border-color: #007bff;
        }

        .form-control-file {
            width: 100%;
        }
    </style>
    <link rel="stylesheet" href="/dmxAppConnect/dmxBootstrap4TableGenerator/dmxBootstrap4TableGenerator.css" />
</head>

<body is="dmx-app" id="cadastro_carros">
    <dmx-value id="imgSourcePrincipal" dmx-bind:value="obterCarro.data.query[0].imgPrincipal"></dmx-value>
    <dmx-value id="servicosArray" dmx-bind:value="obterCarro.data.query[0].servicos.split(',')"></dmx-value>
    <dmx-value id="opcionaisArray" dmx-bind:value="obterCarro.data.query[0].opcionais.split(',')"></dmx-value>
    <dmx-value id="avariasArray" dmx-bind:value="obterCarro.data.query[0].avarias.split(',')"></dmx-value>
    <div is="dmx-browser" id="browser1"></div>
    <dmx-notifications id="notifies1" align="center"></dmx-notifications>
    <dmx-serverconnect id="obterCarro" url="/api/cadastroCarros/obterCarro" dmx-param:id_carro="query.id" dmx-on:success="run([{condition:{outputType:'boolean',if:`obterCarro.data.query1[0].tipo`,then:{steps:{run:{outputType:'text',action:`dadosVeiculo.placatipoatual.setValue(obterCarro.data.query1[0].tipo)`}}},else:{steps:{run:{outputType:'text',action:`dadosVeiculo.placatipoatual.setValue(\'branca\')`}}}}},{comment:{msg:'fim'}}])"></dmx-serverconnect>
    <dmx-query-manager id="query1"></dmx-query-manager>

    <style>
        /* grid igual ao seu two-cols, mas com botões */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(190px, 1fr));
            gap: 10px 14px;
        }

        .options-grid .opt {
            display: contents;
        }

        /* permite o botão ocupar a célula toda */

        .opt-btn {
            height: 62px;
            width: 85%;
            border: 3px solid #cfd2d5;
            border-radius: 12px;
            padding: 12px 12px;
            font: 800 14px/1 "Montserrat", system-ui;
            text-transform: uppercase;
            color: #ffffff;
            background: #44484d;
            /* OFF */
            cursor: pointer;
            transition: transform .08s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
        }

        .opt-btn:hover {
            transform: translateY(-1px);
        }

        .opt-btn:active {
            transform: translateY(0);
        }

        /* estado ON (selecionado) */
        .opt-btn.active {
            background: #2e53a3ff;
            /* verde ON */
            border-color: #ffffffff;
            box-shadow: 0 0 0 3px rgba(39, 176, 255, 0.25);
        }


        .servicos-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(190px, 1fr));
            gap: 10px 14px;
        }

        /* Deixa o botão ocupar a célula inteira do grid */
        .servicos-grid .servui-option {
            display: contents;
        }

        /* Botão de serviço */
        .servui-btn {
            height: 62px;
            width: 85%;
            border: 3px solid #cfd2d5;
            border-radius: 12px;
            padding: 10px 12px;
            font: 800 14px/1 "Montserrat", system-ui;
            text-transform: uppercase;
            color: #fff;
            background: #44484d;
            /* estado OFF */
            cursor: pointer;
            transition: transform .08s ease,
                background .15s ease,
                border-color .15s ease,
                box-shadow .15s ease;
        }

        .servui-btn:hover {
            transform: translateY(-1px);
        }

        /* Estado ON (selecionado) */
        .servui-btn.active {
            background: #b4130eff;
            /* verde */
            border-color: #ffffffff;
            box-shadow: 0 0 0 3px rgba(236, 13, 13, 0.25);
        }

        /* Variante de alerta, se quiser marcar um botão específico com data-variant="danger" */
        .servui-btn.active[data-variant="danger"] {
            background: #ef4444;
            border-color: #c53030;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, .25);
        }

        /* variantes rápidas por data-variant, se quiser outra cor por item */
        /* .opt-btn[data-variant="danger"].active{ background:#ef4444; border-color:#c53030; box-shadow:0 0 0 3px rgba(239,68,68,.25);} */
    </style>

    <form class="page" id="dadosVeiculo" is="dmx-serverconnect-form" method="post" action="/api/cadastroCarros/decisaoEditarCriarCarros" autocomplete="off" dmx-on:success="notifies1.success('cadastro concluído!');browser1.goto('/lista_carros.html')">
        <div class="modal" id="imagensUpload" is="dmx-bs4-modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-dark">
                        <h5 class="modal-title text-light">Envie suas imagens</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="image-uploader">
                            <div class="main-image-container">
                                <label for="imagem1">Imagem Principal</label>
                                <img id="imgPreview1" src="https://via.placeholder.com/400x300" class="main-image-preview">
                                <input id="imagem1" name="imagemPrincipal" type="file" class="form-control-file" onchange="previewImage(this, 'imgPreview1')" accept="image/*">
                            </div>
                            <div class="thumbnail-container">
                                <div class="thumbnail">
                                    <label for="imagem2">Imagem 2</label>
                                    <img id="imgPreview2" src="https://via.placeholder.com/150" class="thumbnail-preview">
                                    <input id="imagem2" name="imagem2" type="file" class="form-control-file" onchange="previewImage(this, 'imgPreview2')" accept="image/*">
                                </div>
                                <div class="thumbnail">
                                    <label for="imagem3">Imagem 3</label>
                                    <img id="imgPreview3" src="https://via.placeholder.com/150" class="thumbnail-preview">
                                    <input id="imagem3" name="imagem3" type="file" class="form-control-file" onchange="previewImage(this, 'imgPreview3')" accept="image/*">
                                </div>
                                <div class="thumbnail">
                                    <label for="imagem4">Imagem 4</label>
                                    <img id="imgPreview4" src="https://via.placeholder.com/150" class="thumbnail-preview">
                                    <input id="imagem4" name="imagem4" type="file" class="form-control-file" onchange="previewImage(this, 'imgPreview4')" accept="image/*">
                                </div>
                                <div class="thumbnail">
                                    <label for="imagem5">Imagem 5</label>
                                    <img id="imgPreview5" src="https://via.placeholder.com/150" class="thumbnail-preview">
                                    <input id="imagem5" name="imagem5" type="file" class="form-control-file" onchange="previewImage(this, 'imgPreview5')" accept="image/*">
                                </div>
                                <div class="thumbnail">
                                    <label for="imagem6">Imagem 6</label>
                                    <img id="imgPreview6" src="https://via.placeholder.com/150" class="thumbnail-preview">
                                    <input id="imagem6" name="imagem6" type="file" class="form-control-file" onchange="previewImage(this, 'imgPreview6')" accept="image/*">
                                </div>
                                <div class="thumbnail">
                                    <label for="imagem7">Imagem 7</label>
                                    <img id="imgPreview7" src="https://via.placeholder.com/150" class="thumbnail-preview">
                                    <input id="imagem7" name="imagem7" type="file" class="form-control-file" onchange="previewImage(this, 'imgPreview7')" accept="image/*">
                                </div>
                            </div>
                        </div>
                        <input id="imgPrincipalURL" name="imgPrincipal" type="hidden" class="form-control" dmx-bind:value="imagem1.file.dataUrl">
                        <input id="imgGaleriaURL" name="imgGaleria" type="hidden" class="form-control" dmx-bind:value="[imagem2.file.dataUrl, imagem3.file.dataUrl, imagem4.file.dataUrl, imagem5.file.dataUrl, imagem6.file.dataUrl, imagem7.file.dataUrl]">
                    </div>
                    <div class="modal-footer bg-dark">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" dmx-on:click="imagensUpload.hide()">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="esquerda">
            <!-- LADO ESQUERDO -->
            <aside class="left-pane">
                <div class="photo-card container">

                    <img src="imgs/car-placeholder.png" dmx-bind:src="imgSourcePrincipal.value"><button id="btn1" class="btn btn-sm btn-outline-primary" dmx-on:click="imagensUpload.show()">ENVIAR IMAGENS&nbsp;<i class="fa fa-arrow-up"></i></button>
                </div>

                <div class="car-title">
                    <strong>CAR NAME (BMW)</strong>
                    <span>ANO 24 HEISEI</span>
                </div>

                <div class="price-box"><span class="price">3.500.000¥</span></div>

                <div class="actions">
                    <button class="ghost" dmx-on:click="dadosVeiculo.submit()">＋ NOVO (F1)</button>
                    <button class="ghost" dmx-on:click="notifies1.success(placatipoatual.value)">✎ EDITAR (F2)</button>
                    <button class="ghost" dmx-on:click="dadosVeiculo.submit()">▮ SALVAR (F5)</button>
                    <button class="danger">🗑 DELETAR</button>
                </div>
            </aside>

        </div>


        <div class="centro">
            <!-- CENTRO: TPageControl -->
            <main class="center-pane">
                <nav class="tabs" role="tablist" aria-label="Seções do veículo">
                    <button class="item tab-btn active" role="tab" aria-selected="true" data-tab-target="#tab-dados">Dados Veículos</button>
                    <button class="item tab-btn" role="tab" aria-selected="false" data-tab-target="#tab-opcionais">Opcionais Veículo</button>
                    <button class="item tab-btn" role="tab" aria-selected="false" data-tab-target="#tab-servicos">Serviços Realizados</button>
                    <button class="item tab-btn" role="tab" aria-selected="false" data-tab-target="#tab-historico">Histórico Placas</button>
                </nav>
                <div class="tab-panels">
                    <!-- ABA 1 -->
                    <div class="tab-panel active" id="tab-dados" role="tabpanel">
                        <div class="grid-form">
                            <input id="id_hidden" name="id_hidden" type="hidden" class="form-control d-print-none" dmx-bind:value="query.id">

                            <label>Marca
                                <input type="text" id="marca" name="marca" dmx-bind:value="obterCarro.data.query[0].marca">
                            </label>
                            <label>Modelo
                                <input type="text" id="model" name="model" dmx-bind:value="obterCarro.data.query[0].model">
                            </label>

                            <label>Cor
                                <input type="text" id="cor" name="cor" dmx-bind:value="obterCarro.data.query[0].cor">
                            </label>
                            <label>Ano de fabricação
                                <div class="composite-input-group composite-inline">
                                    <select id="anoFabricacaoEra" name="ano_fabricacao_era" dmx-bind:value="obterCarro.data.query[0].AnoJap" required="" data-msg-required="Este campo é obrigatório!">
                                        <option value="">Era</option>
                                        <option value="REIWA">REIWA</option>
                                        <option value="HEISEI">HEISEI</option>
                                        <option value="SHOWA">SHOWA</option>
                                    </select>
                                    <input type="text" id="anoFabricacaoAno" name="ano_fabricacao_ano" placeholder="Ano" dmx-bind:value="obterCarro.data.query[0].ano_year" required="" data-msg-required="Este campo é obrigatório!">
                                    <select id="anoFabricacaoMes" name="ano_fabricacao_mes" dmx-bind:value="obterCarro.data.query[0].mes" required="" data-msg-required="Este campo é obrigatório!">
                                        <option value="">Mês</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                </div>
                            </label>

                            <label>KM Rodados
                                <input type="number" id="km" name="km" dmx-bind:value="obterCarro.data.query[0].km">
                            </label>
                            <label>Cilindrada
                                <input type="text" id="cilindrada" name="cilindrada" dmx-bind:value="obterCarro.data.query[0].cilindrada">
                            </label>
                            <label>Chassi
                                <input type="text" id="chassis" name="chassis" dmx-bind:value="obterCarro.data.query[0].chassis">
                            </label>

                            <label>Motor
                                <input type="text" id="motor" name="motor" dmx-bind:value="obterCarro.data.query[0].motor">
                            </label>
                            <label>Número Modelo
                                <input type="text" id="n_modelo" name="n_modelo" dmx-bind:value="obterCarro.data.query[0].n_modelo">
                            </label>
                            <label>Tração
                                <input type="text" id="tracao" name="tracao" dmx-bind:value="obterCarro.data.query[0].tracao">
                            </label>

                            <label>Transmissão
                                <input type="text" id="transmissao" name="transmissao" dmx-bind:value="obterCarro.data.query[0].transmissao">
                            </label>
                            <label>Combustível
                                <input type="text" id="combustivel" name="combustivel" dmx-bind:value="obterCarro.data.query[0].combustivel">
                            </label>
                            <label>Tipo Veículo
                                <input type="text" id="tipo" name="tipo" dmx-bind:value="obterCarro.data.query[0].tipo">
                            </label>

                            <label>Portas
                                <input type="number" id="portas" name="portas" dmx-bind:value="obterCarro.data.query[0].portas">
                            </label>
                            <label>Pessoas
                                <input type="number" id="pessoas" name="pessoas" dmx-bind:value="obterCarro.data.query[0].pessoas">
                            </label>
                            <label>Peso
                                <input type="text" id="peso" name="peso" dmx-bind:value="obterCarro.data.query[0].peso">
                            </label>

                            <label>Carga
                                <input type="text" id="carga" name="carga" dmx-bind:value="obterCarro.data.query[0].carga">
                            </label>
                            <label>Fornecedor
                                <input type="text" id="fornecedor" name="fornecedor" dmx-bind:value="obterCarro.data.query[0].fornecedor">
                            </label>
                            <label>Status
                                <select id="status" name="status" dmx-bind:value="obterCarro.data.query[0].status">
                                    <option value="">Selecione</option>
                                    <option value="Disponível">Disponível</option>
                                    <option value="Reservado">Reservado</option>
                                    <option value="Vendido">Vendido</option>
                                    <option value="Em preparo">Em preparo</option>
                                </select>
                            </label>

                            <label>Preço de Custo (¥)
                                <input type="number" id="custo" name="custo" dmx-bind:value="obterCarro.data.query[0].custo">
                            </label>
                            <label>Preço de Venda (¥)
                                <input type="number" id="venda" name="venda" dmx-bind:value="obterCarro.data.query[0].venda">
                            </label>
                            <label>Cliente
                                <input type="text" id="cliente" name="cliente" dmx-bind:value="obterCarro.data.query[0].cliente">
                            </label>

                            <label>Vistoria (Shaken)
                                <div class="composite-input-group composite-inline shaken-input-group">
                                    <select id="shakenEra" name="shaken_era" dmx-bind:value="obterCarro.data.query[0].shaken_jap" required="" data-msg-required="Este campo é obrigatório!">
                                        <option value="">Era</option>
                                        <option value="REIWA">REIWA</option>
                                        <option value="HEISEI">HEISEI</option>
                                        <option value="SHOWA">SHOWA</option>
                                    </select>
                                    <input type="number" id="shakenAnoEra" name="shaken_ano" placeholder="Ano" inputmode="numeric" dmx-bind:value="obterCarro.data.query[0].shaken_ano" required="" data-msg-required="Este campo é obrigatório!">
                                    <select id="shakenMes" name="shaken_mes" dmx-bind:value="obterCarro.data.query[0].shaken_mes" required="" data-msg-required="Este campo é obrigatório!">
                                        <option value="">Mês</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                    <select id="shakenDia" name="shaken_day" dmx-bind:value="obterCarro.data.query[0].shaken_day" required="" data-msg-required="Este campo é obrigatório!">
                                        <option value="">Dia</option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                        <option value="13">13</option>
                                        <option value="14">14</option>
                                        <option value="15">15</option>
                                        <option value="16">16</option>
                                        <option value="17">17</option>
                                        <option value="18">18</option>
                                        <option value="19">19</option>
                                        <option value="20">20</option>
                                        <option value="21">21</option>
                                        <option value="22">22</option>
                                        <option value="23">23</option>
                                        <option value="24">24</option>
                                        <option value="25">25</option>
                                        <option value="26">26</option>
                                        <option value="27">27</option>
                                        <option value="28">28</option>
                                        <option value="29">29</option>
                                        <option value="30">30</option>
                                        <option value="31">31</option>
                                    </select>
                                </div>
                            </label>

                            <div class="ghost-cell"></div>

                            <label class="full">Outros
                                <textarea rows="5" id="outros" name="outros" dmx-bind:value="obterCarro.data.query[0].outros"></textarea>
                            </label>
                        </div>
                    </div>

                    <!-- ABA 2 -->
                    <div class="tab-panel" id="tab-opcionais" role="tabpanel" aria-hidden="true">
                        <div class="pad two-cols options-grid" id="opcionais">
                            <!-- cada botão tem um checkbox hidden pareado (mesmo valor) -->
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="ABS" id="ABS" dmx-class:active="opcionalABS.checked">ABS</button>
                                <input type="checkbox" id="opcionalABS" name="opcionais[]" value="1" data-label="ABS" hidden="" dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Bancos elétricos" id="bancosEletricos" dmx-class:active="opcionalBancosEletricos.checked">Bancos elétricos</button>
                                <input type="checkbox" id="opcionalBancosEletricos" name="opcionais[]" value="2" data-label="Bancos elétricos" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="ESC" id="ESC" dmx-class:active="opcionalESC.checked">ESC</button>
                                <input type="checkbox" id="opcionalESC" name="opcionais[]" value="3" data-label="ESC" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Key-Less" id="keyless" dmx-class:active="opcionalKeyless.checked">Key-Less</button>
                                <input type="checkbox" id="opcionalKeyless" name="opcionais[]" value="4" data-label="Key-Less" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Porta de correr" id="portaDeCorrer" dmx-class:active="opcionalPortaDeCorrer.checked">Porta de correr</button>
                                <input type="checkbox" id="opcionalPortaDeCorrer" name="opcionais[]" value="5" data-label="Porta de correr" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Veículo especial" id="veiculoEspecial" dmx-class:active="opcionalVeiculoEspecial.checked">Veículo especial</button>
                                <input type="checkbox" id="opcionalVeiculoEspecial" name="opcionais[]" value="6" data-label="Veículo especial" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Alarme" id="alarme" dmx-class:active="opcionalAlarme.checked">Alarme</button>
                                <input type="checkbox" id="opcionalAlarme" name="opcionais[]" value="7" data-label="Alarme" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Bancos de couro" id="bancosDeCouro" dmx-class:active="opcionalBancosDeCouro.checked">Bancos de couro</button>
                                <input type="checkbox" id="opcionalBancosDeCouro" name="opcionais[]" value="8" data-label="Bancos de couro" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="ETC" id="ETC" dmx-class:active="opcionalETC.checked">ETC</button>
                                <input type="checkbox" id="opcionalETC" name="opcionais[]" value="9" data-label="ETC" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Kit Aero" id="kitAero" dmx-class:active="opcionalKitAero.checked">Kit Aero</button>
                                <input type="checkbox" id="opcionalKitAero" name="opcionais[]" value="10" data-label="Kit Aero" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Rebaixado" id="rebaixado" dmx-class:active="opcionalRebaixado.checked">Rebaixado</button>
                                <input type="checkbox" id="opcionalRebaixado" name="opcionais[]" value="11" data-label="Rebaixado" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Vidros elétricos" id="vidrosEletricos" dmx-class:active="opcionalVidrosEletricos.checked">Vidros elétricos</button>
                                <input type="checkbox" id="opcionalVidrosEletricos" name="opcionais[]" value="12" data-label="Vidros elétricos" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="AirBag" id="airbag" dmx-class:active="opcionalAirbag.checked">AirBag</button>
                                <input type="checkbox" id="opcionalAirbag" name="opcionais[]" value="13" data-label="AirBag" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Carro Novo" id="carroNovo" dmx-class:active="opcionalCarroNovo.checked">Carro Novo</button>
                                <input type="checkbox" id="opcionalCarroNovo" name="opcionais[]" value="14" data-label="Carro Novo" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Teto Solar" id="tetoSolar" dmx-class:active="opcionalTetoSolar.checked">Teto Solar</button>
                                <input type="checkbox" id="opcionalTetoSolar" name="opcionais[]" value="15" data-label="Teto Solar" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Manual do Proprietário" id="manualDoProprietrio" dmx-class:active="opcionalManualDoProprietrio.checked">Manual do Proprietário</button>
                                <input type="checkbox" id="opcionalManualDoProprietrio" name="opcionais[]" value="16" data-label="Manual do Proprietário" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Rodas de alumínio" id="rodasDeAluminio" dmx-class:active="opcionalRodasDeAluminio.checked">Rodas de alumínio</button>
                                <input type="checkbox" id="opcionalRodasDeAluminio" name="opcionais[]" value="17" data-label="Rodas de alumínio" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="3 Fileiras de Bancos" id="tresFileirasDeBancos" dmx-class:active="opcionalTresFileirasDeBancos.checked">3 Fileiras de Bancos</button>
                                <input type="checkbox" id="opcionalTresFileirasDeBancos" name="opcionais[]" value="18" data-label="3 Fileiras de Bancos" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Corredor" id="corredor" dmx-class:active="opcionalCorredor.checked">Corredor</button>
                                <input type="checkbox" id="opcionalCorredor" name="opcionais[]" value="19" data-label="Corredor" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Faróis Xenom" id="faroisXenom" dmx-class:active="opcionalFaroisXenom.checked">Faróis Xenom</button>
                                <input type="checkbox" id="opcionalFaroisXenom" name="opcionais[]" value="20" data-label="Faróis Xenom" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Monitor Traseiro" id="monitorTraseiro" dmx-class:active="opcionalMonitorTraseiro.checked">Monitor Traseiro</button>
                                <input type="checkbox" id="opcionalMonitorTraseiro" name="opcionais[]" value="21" data-label="Monitor Traseiro" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Trava Automática" id="travaAutomatica" dmx-class:active="opcionalTravaAutomatica.checked">Trava Automática</button>
                                <input type="checkbox" id="opcionalTravaAutomatica" name="opcionais[]" value="22" data-label="Trava Automática" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="4WD" id="fourWD" dmx-class:active="opcionalFourWD.checked">4WD</button>
                                <input type="checkbox" id="opcionalFourWD" name="opcionais[]" value="23" data-label="4WD" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="CD-MD" id="cdmd" dmx-class:active="opcionalCdmd.checked">CD-MD</button>
                                <input type="checkbox" id="opcionalCdmd" name="opcionais[]" value="24" data-label="CD-MD" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Histórico de Tenken" id="historicoTenken" dmx-class:active="opcionalHistoricoTenken.checked">Histórico de Tenken</button>
                                <input type="checkbox" id="opcionalHistoricoTenken" name="opcionais[]" value="25" data-label="Histórico de Tenken" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Não fumante" id="naoFumante" dmx-class:active="opcionalNaoFumante.checked">Não fumante</button>
                                <input type="checkbox" id="opcionalNaoFumante" name="opcionais[]" value="26" data-label="Não fumante" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Turbo" id="turbo" dmx-class:active="opcionalTurbo.checked">Turbo</button>
                                <input type="checkbox" id="opcionalTurbo" name="opcionais[]" value="27" data-label="Turbo" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Câmera frontal" id="cameraFrontal" dmx-class:active="opcionalCameraFrontal.checked">Câmera frontal</button>
                                <input type="checkbox" id="opcionalCameraFrontal" name="opcionais[]" value="28" data-label="Câmera frontal" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Banco Sofá" id="bancoSofa" dmx-class:active="opcionalBancoSofa.checked">Banco Sofá</button>
                                <input type="checkbox" id="opcionalBancoSofa" name="opcionais[]" value="29" data-label="Banco Sofá" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Direção Hidráulica" id="direcaoHidraulica" dmx-class:active="opcionalDirecaoHidraulica.checked">Direção Hidráulica</button>
                                <input type="checkbox" id="opcionalDirecaoHidraulica" name="opcionais[]" value="30" data-label="Direção Hidráulica" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Importados" id="importados" dmx-class:active="opcionalImportados.checked">Importados</button>
                                <input type="checkbox" id="opcionalImportados" name="opcionais[]" value="31" data-label="Importados" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Navi-TV" id="naviTV" dmx-class:active="opcionalNaviTV.checked">Navi-TV</button>
                                <input type="checkbox" id="opcionalNaviTV" name="opcionais[]" value="32" data-label="Navi-TV" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Único Dono" id="unicoDono" dmx-class:active="opcionalUnicoDono.checked">Único Dono</button>
                                <input type="checkbox" id="opcionalUnicoDono" name="opcionais[]" value="33" data-label="Único Dono" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Câmera Traseira" id="cameraTraseira" dmx-class:active="opcionalCameraTraseira.checked">Câmera Traseira</button>
                                <input type="checkbox" id="opcionalCameraTraseira" name="opcionais[]" value="34" data-label="Câmera Traseira" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Ar Condicionado" id="arCondicionado" dmx-class:active="opcionalArCondicionado.checked">Ar Condicionado</button>
                                <input type="checkbox" id="opcionalArCondicionado" name="opcionais[]" value="35" data-label="Ar Condicionado" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>
                            <div class="opt">
                                <button type="button" class="opt-btn" data-value="Ar Condicionado Traseiro" id="arCondicionadoTraseiro" dmx-class:active="opcionalArCondicionadoTraseiro.checked">Ar Condicionado Traseiro</button>
                                <input type="checkbox" id="opcionalArCondicionadoTraseiro" name="opcionais[]" value="36" data-label="Ar Condicionado Traseiro" hidden dmx-bind:checked="opcionaisArray.value.contains(value)">
                            </div>

                        </div>
                    </div>

                    <!-- ABA 3 -->
                    <div class="tab-panel" id="tab-servicos" role="tabpanel" aria-hidden="true">
                        <div class="pad two-cols servicos-grid" id="servicos">
                            <!-- Cada bloco: botão visível + checkbox hidden que envia no form -->
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Higienização" id="higienizacao" dmx-class:active="servicoHigienizacao.checked">Higienização</button>
                                <input type="checkbox" id="servicoHigienizacao" name="servicos[]" value="1" data-label="Higienização" hidden="" dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Polimento" id="polimento" dmx-class:active="servicoPolimento.checked">Polimento</button>
                                <input type="checkbox" id="servicoPolimento" name="servicos[]" value="2" data-label="Polimento" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Cristalização" id="cristalizacao" dmx-class:active="servicoCristalizacao.checked">Cristalização</button>
                                <input type="checkbox" id="servicoCristalizacao" name="servicos[]" value="3" data-label="Cristalização" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Limpeza do ar condicionado" id="limpezaArCondicionado" dmx-class:active="servicoLimpezaArCondicionado.checked">Limpeza do ar condicionado</button>
                                <input type="checkbox" id="servicoLimpezaArCondicionado" name="servicos[]" value="4" data-label="Limpeza do ar condicionado" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de filtro do ar" id="trocaFiltroAr" dmx-class:active="servicoTrocaFiltroAr.checked">Troca de filtro do ar</button>
                                <input type="checkbox" id="servicoTrocaFiltroAr" name="servicos[]" value="5" data-label="Troca de filtro do ar" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de óleo" id="trocaOleo" dmx-class:active="servicoTrocaOleo.checked">Troca de óleo</button>
                                <input type="checkbox" id="servicoTrocaOleo" name="servicos[]" value="6" data-label="Troca de óleo" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de filtro de óleo" id="trocaFiltroOleo" dmx-class:active="servicoTrocaFiltroOleo.checked">Troca de filtro de óleo</button>
                                <input type="checkbox" id="servicoTrocaFiltroOleo" name="servicos[]" value="7" data-label="Troca de filtro de óleo" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de filtro do combustível" id="trocaFiltroCombustivel" dmx-class:active="servicoTrocaFiltroCombustivel.checked">Troca de filtro do combustível</button>
                                <input type="checkbox" id="servicoTrocaFiltroCombustivel" name="servicos[]" value="8" data-label="Troca de filtro do combustível" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Alinhamento dos pneus" id="alinhamentoPneus" dmx-class:active="servicoAlinhamentoPneus.checked">Alinhamento dos pneus</button>
                                <input type="checkbox" id="servicoAlinhamentoPneus" name="servicos[]" value="9" data-label="Alinhamento dos pneus" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de pneus" id="trocaPneus" dmx-class:active="servicoTrocaPneus.checked">Troca de pneus</button>
                                <input type="checkbox" id="servicoTrocaPneus" name="servicos[]" value="10" data-label="Troca de pneus" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca da buzina" id="trocaBuzina" dmx-class:active="servicoTrocaBuzina.checked">Troca da buzina</button>
                                <input type="checkbox" id="servicoTrocaBuzina" name="servicos[]" value="11" data-label="Troca da buzina" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca dos cintos de segurança" id="trocaCintos" dmx-class:active="servicoTrocaCintos.checked">Troca dos cintos de segurança</button>
                                <input type="checkbox" id="servicoTrocaCintos" name="servicos[]" value="12" data-label="Troca dos cintos de segurança" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de embreagem" id="trocaEmbreagem" dmx-class:active="servicoTrocaEmbreagem.checked">Troca de embreagem</button>
                                <input type="checkbox" id="servicoTrocaEmbreagem" name="servicos[]" value="13" data-label="Troca de embreagem" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de fluido da direção hidráulica" id="trocaFluidoDirecao" dmx-class:active="servicoTrocaFluidoDirecao.checked">Troca de fluido da direção hidráulica</button>
                                <input type="checkbox" id="servicoTrocaFluidoDirecao" name="servicos[]" value="14" data-label="Troca de fluido da direção hidráulica" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de fluido de freio" id="trocaFluidoFreio" dmx-class:active="servicoTrocaFluidoFreio.checked">Troca de fluido de freio</button>
                                <input type="checkbox" id="servicoTrocaFluidoFreio" name="servicos[]" value="15" data-label="Troca de fluido de freio" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de limpadores de parabrisas" id="trocaLimpadores" dmx-class:active="servicoTrocaLimpadores.checked">Troca de limpadores de parabrisa</button>
                                <input type="checkbox" id="servicoTrocaLimpadores" name="servicos[]" value="16" data-label="Troca de limpadores de parabrisas" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de bateria" id="trocaBateria" dmx-class:active="servicoTrocaBateria.checked">Troca de bateria</button>
                                <input type="checkbox" id="servicoTrocaBateria" name="servicos[]" value="17" data-label="Troca de bateria" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do sistema de freios" id="trocaSistemaFreios" dmx-class:active="servicoTrocaSistemaFreios.checked">Troca do sistema de freios</button>
                                <input type="checkbox" id="servicoTrocaSistemaFreios" name="servicos[]" value="18" data-label="Troca do sistema de freios" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do sistema de suspensão" id="trocaSistemaSuspensao" dmx-class:active="servicoTrocaSistemaSuspensao.checked">Troca do sistema de suspenção</button>
                                <input type="checkbox" id="servicoTrocaSistemaSuspensao" name="servicos[]" value="19" data-label="Troca do sistema de suspensão" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de velas" id="trocaVelas" dmx-class:active="servicoTrocaVelas.checked">Troca de velas</button>
                                <input type="checkbox" id="servicoTrocaVelas" name="servicos[]" value="20" data-label="Troca de velas" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do líquido de arrefecimento" id="trocaArrefecimento" dmx-class:active="servicoTrocaArrefecimento.checked">Troca do líquido de arrefecimento</button>
                                <input type="checkbox" id="servicoTrocaArrefecimento" name="servicos[]" value="21" data-label="Troca do líquido de arrefecimento" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de fluido das transmissões" id="trocaFluidoTransmissao" dmx-class:active="servicoTrocaFluidoTransmissao.checked">Troca de fluido das transmissões</button>
                                <input type="checkbox" id="servicoTrocaFluidoTransmissao" name="servicos[]" value="22" data-label="Troca de fluido das transmissões" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca do filtro de cabine" id="trocaFiltroCabine" dmx-class:active="servicoTrocaFiltroCabine.checked">Troca do filtro de cabine</button>
                                <input type="checkbox" id="servicoTrocaFiltroCabine" name="servicos[]" value="23" data-label="Troca do filtro de cabine" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de correia poly-v" id="trocaCorreiaPolyv" dmx-class:active="servicoTrocaCorreiaPolyv.checked">Troca de correia poly-v</button>
                                <input type="checkbox" id="servicoTrocaCorreiaPolyv" name="servicos[]" value="24" data-label="Troca de correia poly-v" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de correia dentada" id="trocaCorreiaDentada" dmx-class:active="servicoTrocaCorreiaDentada.checked">Troca de correia dentada</button>
                                <input type="checkbox" id="servicoTrocaCorreiaDentada" name="servicos[]" value="25" data-label="Troca de correia dentada" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Correia do compressor do ar condicionado" id="trocaCorreiaCompressor" dmx-class:active="servicoTrocaCorreiaCompressor.checked">Correia do compressor do ar condicionado</button>
                                <input type="checkbox" id="servicoTrocaCorreiaCompressor" name="servicos[]" value="26" data-label="Correia do compressor do ar condicionado" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                            <div class="servui-option">
                                <button type="button" class="servui-btn" data-value="Troca de correia do alternador" id="trocaCorreiaAlternador" dmx-class:active="servicoTrocaCorreiaAlternador.checked">Troca de correia do alternador</button>
                                <input type="checkbox" id="servicoTrocaCorreiaAlternador" name="servicos[]" value="27" data-label="Troca de correia do alternador" hidden dmx-bind:checked="servicosArray.value.contains(value)">
                            </div>
                        </div>
                    </div>

                    <!-- ABA 4 -->
                    <div class="tab-panel" id="tab-historico" role="tabpanel" aria-hidden="true">
                        <div class="jp-plate-wrap">
                            <!-- Botão visual da placa: clique alterna branca/amarela -->
                            <button type="button" class="jp-plate" id="jpPlate" aria-pressed="false" title="Clique para alternar: Futsuusha ↔ Keijidōsha" dmx-on:click="run({condition:{outputType:'boolean',if:`(placatipoatual.value != \'amarela\')`,then:{steps:{run:{outputType:'text',action:`placatipoatual.setValue(\'amarela\')`}}},else:{steps:{run:{outputType:'text',action:`placatipoatual.setValue(\'branca\')`}}}}})">
                                <span class="plate-region" id="outRegion">東京</span>
                                <span class="plate-class" id="outClass">300</span>
                                <span class="plate-mark" id="outMark">あ</span>
                                <span class="plate-number" id="outNumber"><span>12</span>-<span>34</span></span>
                                <span class="plate-type-badge" id="plateTypeBadge">普通車</span>
                            </button>

                            <!-- Controles -->
                            <div class="jp-plate-controls">
                                <div class="row">
                                    <dmx-value id="placatipoatual"></dmx-value>
                                    <input id="textplacatipo" name="placa_tipo" type="hidden" class="form-control" dmx-bind:value="placatipoatual.value">
                                    <label>Região
                                        <input id="inRegion" name="placa_regiao" type="text" placeholder="ex.: 東京">
                                    </label>
                                    <label>Classe
                                        <input id="inClass" name="placa_classe" type="number" placeholder="ex.: 300">
                                    </label>
                                    <label>Hiragana
                                        <input id="inMark" name="placa_hiragana" type="text" placeholder="ex.: あ" maxlength="1">
                                    </label>
                                    <label>Número
                                        <input id="inNumber" name="placa_numero" type="number" placeholder="ex.: 1234" pattern="\d{4}" maxlength="4">
                                    </label>
                                </div>

                                <div class="actions">
                                    <button type="button" class="item2" id="btnApply">Aplicar na placa</button>
                                    <button type="button" class="item2" id="btnAddHistory" dmx-on:click="run([{condition:{outputType:'boolean',if:`placatipoatual.value.isEmpty()`,then:{steps:{run:{outputType:'text',action:`placatipoatual.setValue(\'branca\')`}}}}},{run:{outputType:'text',action:`formHistoricoPlaca.submit()`}}])">Adicionar ao histórico</button>
                                </div>
                            </div>


                            <!-- Histórico -->
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Regiao</th>
                                            <th>Classe</th>
                                            <th>Hiragana</th>
                                            <th>Numero</th>
                                            <th>Tipo</th>
                                        </tr>
                                    </thead>
                                    <tbody is="dmx-repeat" dmx-generator="bs4table" dmx-bind:repeat="obterCarro.data.query1" id="tableRepeat2">
                                        <tr>
                                            <td dmx-text="regiao"></td>
                                            <td dmx-text="classe"></td>
                                            <td dmx-text="hiragana"></td>
                                            <td dmx-text="numero"></td>
                                            <td dmx-text="tipo"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

        </div>

        <div class="direita">
            <!-- DIREITA: diagrama com pontos -->
            <aside class="right-pane">
                <div class="car-diagram" id="avariasDiagrama">
                    <img src="/assets/images/diagram-car-top.png" alt="Diagrama do carro">
                    <!-- Ajuste as posições (%) conforme sua arte -->
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:50%; --y:15%" dmx-class:alert="avaria1.checked"></button>
                        <input type="checkbox" id="avaria1" name="avarias[]" value="1" hidden="" dmx-bind:checked="avariasArray.value.contains(value)" dmx-hide="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:16%; --y:24%" dmx-class:alert="avaria2.checked"></button>
                        <input type="checkbox" id="avaria2" name="avarias[]" value="2" hidden="" dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:84%; --y:24%" dmx-class:alert="avaria3.checked"></button>
                        <input type="checkbox" id="avaria3" name="avarias[]" value="3" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:16%; --y:40%" dmx-class:alert="avaria4.checked"></button>
                        <input type="checkbox" id="avaria4" name="avarias[]" value="4" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:84%; --y:40%" dmx-class:alert="avaria5.checked"></button>
                        <input type="checkbox" id="avaria5" name="avarias[]" value="5" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:16%; --y:56%" dmx-class:alert="avaria6.checked"></button>
                        <input type="checkbox" id="avaria6" name="avarias[]" value="6" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:84%; --y:56%" dmx-class:alert="avaria7.checked"></button>
                        <input type="checkbox" id="avaria7" name="avarias[]" value="7" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:16%; --y:72%" dmx-class:alert="avaria8.checked"></button>
                        <input type="checkbox" id="avaria8" name="avarias[]" value="8" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:84%; --y:72%" dmx-class:alert="avaria9.checked"></button>
                        <input type="checkbox" id="avaria9" name="avarias[]" value="9" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:50%; --y:33%" dmx-class:alert="avaria10.checked"></button>
                        <input type="checkbox" id="avaria10" name="avarias[]" value="10" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:50%; --y:71%" dmx-class:alert="avaria11.checked"></button>
                        <input type="checkbox" id="avaria11" name="avarias[]" value="11" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                    <div class="dot-wrapper">
                        <button type="button" class="dot" style="--x:50%; --y:85%" dmx-class:alert="avaria12.checked"></button>
                        <input type="checkbox" id="avaria12" name="avarias[]" value="12" hidden dmx-bind:checked="avariasArray.value.contains(value)">
                    </div>
                </div>
            </aside>

        </div>

    </form>
    <form id="formHistoricoPlaca" is="dmx-serverconnect-form" method="post" action="/api/cadastroCarros/historicoPlaca" dmx-on:success="notifies1.success('deu bom');obterCarro.load({})">
        <input id="text6" name="placa_id" type="hidden" class="form-control" dmx-bind:value="query.id">
        <input id="text5" name="placa_numero" type="hidden" class="form-control" dmx-bind:value="dadosVeiculo.inNumber.value">
        <input id="text4" name="placa_hiragana" type="hidden" class="form-control" dmx-bind:value="dadosVeiculo.inMark.value">
        <input id="text3" name="placa_classe" type="hidden" class="form-control" dmx-bind:value="dadosVeiculo.inClass.value">
        <input id="text2" name="placa_regiao" type="hidden" class="form-control" dmx-bind:value="dadosVeiculo.inRegion.value">
        <input id="text1" name="placa_tipo" type="hidden" class="form-control" dmx-bind:value="dadosVeiculo.textplacatipo.value">
    </form>

    <!-- JS: tabs + dots -->
    <script>
        const form = document.getElementById('dadosVeiculo');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const panels = document.querySelectorAll('.tab-panel');

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const tgt = document.querySelector(btn.dataset.tabTarget);
                tabButtons.forEach(b => {
                    const active = b === btn;
                    b.classList.toggle('active', active);
                    b.setAttribute('aria-selected', active ? 'true' : 'false');
                });
                panels.forEach(p => {
                    const active = (p === tgt);
                    p.classList.toggle('active', active);
                    p.toggleAttribute('aria-hidden', !active);
                });
            });
        });

        const getSelectedIds = selector => {
            if (!form) return [];
            return Array.from(form.querySelectorAll(selector))
                .map(el => Number(el.value))
                .filter(num => Number.isFinite(num));
        };

        const updateFeatures = () => {
            if (!form) return;
            const cmimgField = form.querySelector('#cmimg');
            if (!cmimgField) return;
            const opcionaisSel = getSelectedIds('#opcionais input[type=\"checkbox\"]:checked');
            const servicosSel = getSelectedIds('#servicos input[type=\"checkbox\"]:checked');
            cmimgField.value = JSON.stringify({ opcionais: opcionaisSel, servicos: servicosSel });
        };

        document.querySelectorAll('#opcionais .opt').forEach(w => {
            const btn = w.querySelector('.opt-btn');
            const chk = w.querySelector('input[type=\"checkbox\"]');
            if (!btn || !chk) return;
            if (chk.checked) btn.classList.add('active');
            btn.setAttribute('aria-pressed', chk.checked ? 'true' : 'false');
            btn.addEventListener('click', () => {
                const on = !chk.checked;
                chk.checked = on;
                btn.classList.toggle('active', on);
                btn.setAttribute('aria-pressed', on ? 'true' : 'false');
                updateFeatures();
            });
        });

        (function initServicos(){
            const wrap = document.getElementById('servicos');
            if (!wrap) return;
            wrap.querySelectorAll('.servui-option').forEach(opt => {
                const btn = opt.querySelector('.servui-btn');
                const chk = opt.querySelector('input[type=\"checkbox\"]');
                if (!btn || !chk) return;
                if (chk.checked) btn.classList.add('active');
                btn.setAttribute('aria-pressed', chk.checked ? 'true' : 'false');
                btn.addEventListener('click', () => {
                    const on = !chk.checked;
                    chk.checked = on;
                    btn.classList.toggle('active', on);
                    btn.setAttribute('aria-pressed', on ? 'true' : 'false');
                    updateFeatures();
                });
            });
        })();

        updateFeatures();

        const formatCurrency = value => {
            const num = Number(String(value).replace(/[^0-9.-]/g, ''));
            if (!value || Number.isNaN(num)) return '';
            return num.toLocaleString('ja-JP') + '¥';
        };

        (function initComputed(){
            if (!form) return;
            const marca = form.querySelector('#marca');
            const modelo = form.querySelector('#model');
            const veiculo = form.querySelector('#veiculo');
            const custo = form.querySelector('#custo');
            const venda = form.querySelector('#venda');
            const custoVisual = form.querySelector('#custo_visual');
            const vendaVisual = form.querySelector('#venda_visual');
            const anoFabricacaoAno = form.querySelector('#anoFabricacaoAno');
            const anoFabricacaoMes = form.querySelector('#anoFabricacaoMes');
            const anoFabricacaoAnoHidden = form.querySelector('#anoFabricacaoAnoHidden');
            const anoFabricacaoMesHidden = form.querySelector('#anoFabricacaoMesHidden');
            const shakenEra = form.querySelector('#shakenEra');
            const shakenAno = form.querySelector('#shakenAnoEra');
            const shakenMes = form.querySelector('#shakenMes');
            const shakenDia = form.querySelector('#shakenDia');
            const shakenVisual = form.querySelector('#shaken_visual');
            const shakenEraHidden = form.querySelector('#shakenEraHidden');

            const syncVeiculo = () => {
                if (!veiculo) return;
                const parts = [marca?.value, modelo?.value].filter(Boolean);
                veiculo.value = parts.join(' ').trim();
            };
            [marca, modelo].forEach(el => el && el.addEventListener('input', syncVeiculo));
            syncVeiculo();

            const syncCurrency = () => {
                if (custo && custoVisual) custoVisual.value = formatCurrency(custo.value);
                if (venda && vendaVisual) vendaVisual.value = formatCurrency(venda.value);
            };
            [custo, venda].forEach(el => el && el.addEventListener('input', syncCurrency));
            syncCurrency();

            const syncFabricacaoHidden = () => {
                if (anoFabricacaoAnoHidden && anoFabricacaoAno) {
                    anoFabricacaoAnoHidden.value = anoFabricacaoAno.value;
                }
                if (anoFabricacaoMesHidden && anoFabricacaoMes) {
                    anoFabricacaoMesHidden.value = anoFabricacaoMes.value;
                }
            };
            [anoFabricacaoAno, anoFabricacaoMes].forEach(el => {
                if (!el) return;
                el.addEventListener('input', syncFabricacaoHidden);
                el.addEventListener('change', syncFabricacaoHidden);
            });
            syncFabricacaoHidden();

            const syncShakenHidden = () => {
                if (shakenEraHidden && shakenEra) {
                    shakenEraHidden.value = shakenEra.value;
                }
            };
            if (shakenEra) {
                shakenEra.addEventListener('input', syncShakenHidden);
                shakenEra.addEventListener('change', syncShakenHidden);
            }
            syncShakenHidden();

            const syncShakenVisual = () => {
                if (!shakenVisual) return;
                const ano = shakenAno?.value || '';
                const mes = shakenMes?.value || '';
                const dia = shakenDia?.value || '';
                const parts = [ano, mes, dia].filter(Boolean);
                shakenVisual.value = parts.join('/');
            };
            [shakenAno, shakenMes, shakenDia].forEach(el => {
                if (!el) return;
                el.addEventListener('input', syncShakenVisual);
                el.addEventListener('change', syncShakenVisual);
            });
            syncShakenVisual();
        })();

        (function initDots(){
            const wrap = document.getElementById('avariasDiagrama');
            if (!wrap) return;
            wrap.querySelectorAll('.dot-wrapper').forEach(dotWrapper => {
                const btn = dotWrapper.querySelector('.dot');
                const chk = dotWrapper.querySelector('input[type="checkbox"]');
                if (!btn || !chk) return;

                // Seta o estado inicial de acessibilidade. A classe visual é controlada pelo Wappler (dmx-class:alert)
                btn.setAttribute('aria-pressed', chk.checked ? 'true' : 'false');

                btn.addEventListener('click', () => {
                    // Inverte o estado do checkbox
                    const on = !chk.checked;
                    chk.checked = on;

                    // Dispara o evento 'change' manualmente para que o Wappler atualize os bindings (dmx-class)
                    chk.dispatchEvent(new Event('change', { 'bubbles': true }));

                    // Atualiza o atributo de acessibilidade
                    btn.setAttribute('aria-pressed', on ? 'true' : 'false');
                });
            });
        })();;

        (function placaJaponesa(){
            const plate   = document.getElementById('jpPlate');
            if (!plate) return;
            const badge   = document.getElementById('plateTypeBadge');

            const inRegion = document.getElementById('inRegion');
            const inClass  = document.getElementById('inClass');
            const inMark   = document.getElementById('inMark');
            const inNumber = document.getElementById('inNumber');

            const outRegion = document.getElementById('outRegion');
            const outClass  = document.getElementById('outClass');
            const outMark   = document.getElementById('outMark');
            const outNumber = document.getElementById('outNumber');

            const btnApply = document.getElementById('btnApply');
            const btnAdd   = document.getElementById('btnAddHistory');
            const list     = document.getElementById('plateHistory');
            const placaHidden = document.getElementById('placa');

            const syncPlacatype = () => {
                if (!placaHidden) return;
                placaHidden.value = plate.classList.contains('is-kei') ? 'Amarela' : 'Branca';
            };
            syncPlacatype();

            plate.addEventListener('click', (e) => {
                if (e.target.closest('.jp-plate-controls')) return;
                const isKei = plate.classList.toggle('is-kei');
                plate.setAttribute('aria-pressed', isKei ? 'true' : 'false');
                badge.textContent = isKei ? '軽自動車' : '普通車';
                syncPlacatype();
            });

            btnApply?.addEventListener('click', () => {
                const region = (inRegion?.value || outRegion.textContent).trim();
                const klass  = (inClass?.value  || outClass.textContent).trim();
                const mark   = (inMark?.value   || outMark.textContent).trim();
                const num    = (inNumber?.value || outNumber.textContent.replace('-', '')).trim();

                let numFmt = outNumber.innerHTML;
                if (/^\\d{4}$/.test(num)) {
                    numFmt = `<span>${num.slice(0,2)}</span>-<span>${num.slice(2)}</span>`;
                }

                outRegion.textContent = region || '東京';
                outClass.textContent  = klass  || '300';
                outMark.textContent   = mark   || 'あ';
                outNumber.innerHTML   = numFmt;
                plate.animate([{filter:'brightness(1.2)'},{filter:'brightness(1)'}], {duration:180, easing:'ease-out'});
            });

            btnAdd?.addEventListener('click', () => {
                const isKei = plate.classList.contains('is-kei');
                const txt   = `${outRegion.textContent} ${outClass.textContent} ${outMark.textContent} ${outNumber.textContent.replace(/<[^>]*>/g,'')} — ${isKei ? 'Keijidōsha (amarela)' : 'Futsuusha (branca)'}`;
                const li = document.createElement('li');
                li.textContent = txt;
                list?.prepend(li);
                li.animate([{opacity:0, transform:'translateY(-4px)'},{opacity:1, transform:'translateY(0)'}], {duration:160, easing:'ease-out'});
            });
        })();

        updateFeatures();
    </script>
    <script>
        function previewImage(input, imgId) {
    const img = document.getElementById(imgId);
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            img.src = e.target.result;
        }
        reader.readAsDataURL(input.files[0]);
    }
}
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
</body>

</html>