{"version":3,"sources":["components/masonry.js"],"names":["dmx","Component","extends","attributes","breakpoints","type","Object","default","columns","Number","columnsSm","columnsMd","columnsLg","columnsXl","columnsXxl","gutter","gutterSm","gutterMd","gutterLg","gutterXl","gutterXxl","preserveOrder","Boolean","animated","animationDuration","methods","reflow","this","_reflow","init","node","_breakpoints","sm","md","lg","xl","xxl","_debounce","bind","_resizeObserver","ResizeObserver","observe","window","addEventListener","prototype","call","render","style","setProperty","performUpdate","updatedProps","has","destroy","disconnect","removeEventListener","fn","delay","handle","e","dmxMasonry","cb","apply","arguments","clearTimeout","setTimeout","cancelAnimationFrame","requestAnimationFrame","children","length","$node","querySelectorAll","forEach","img","once","src","props","assign","breakpoint","innerWidth","suffix","toUpperCase","slice","nodes","Array","from","getComputedStyle","padding","parseInt","paddingLeft","paddingRight","columnWidth","Math","floor","clientWidth","event","Event","dispatchEvent","columnHeights","fill","nodesHeights","map","clientHeight","index","i","indexOf","min","x","y","dmxMasonryInit","max"],"mappings":"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","file":"dmxMasonry.js","sourcesContent":["dmx.Component('masonry', {\r\n\r\n  extends: 'repeat',\r\n\r\n  attributes: {\r\n    breakpoints: {\r\n      type: Object,\r\n      default: {},\r\n    },\r\n\r\n    columns: {\r\n      type: Number,\r\n      default: 4,\r\n    },\r\n\r\n    columnsSm: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    columnsMd: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    columnsLg: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    columnsXl: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    columnsXxl: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    gutter: {\r\n      type: Number,\r\n      default: 15,\r\n    },\r\n\r\n    gutterSm: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    gutterMd: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    gutterLg: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    gutterXl: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    gutterXxl: {\r\n      type: Number,\r\n      default: null,\r\n    },\r\n\r\n    preserveOrder: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    animated: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n\r\n    animationDuration: {\r\n      type: Number,\r\n      default: 400,\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    reflow () {\r\n      this._reflow();\r\n    },\r\n  },\r\n\r\n  init (node) {\r\n    this._breakpoints = { sm: 480, md: 768, lg: 992, xl: 1200, xxl: 1400 };\r\n    this._reflow = this._debounce(this._reflow.bind(this));\r\n    this._resizeObserver = new ResizeObserver(this._reflow);\r\n    this._resizeObserver.observe(node);\r\n\r\n    window.addEventListener('resize', this._reflow);\r\n\r\n    dmx.Component('repeat').prototype.init.call(this, node);\r\n  },\r\n\r\n  render (node) {\r\n    node.style.setProperty('position', 'relative');\r\n    this._reflow();\r\n  },\r\n\r\n  performUpdate (updatedProps) {\r\n    if (updatedProps.has('repeat') || updatedProps.has('key')) {\r\n      dmx.Component('repeat').prototype.performUpdate.call(this, updatedProps);\r\n    }\r\n\r\n    this._reflow();\r\n  },\r\n\r\n  destroy () {\r\n    this._resizeObserver.disconnect();\r\n    window.removeEventListener('resize', this._reflow);\r\n  },\r\n\r\n  // custom debounce to ignore events dispatched by this component\r\n  _debounce: (fn, delay) => {\r\n    let handle;\r\n\r\n    return function (e) {\r\n      // skip if dispatched by this component\r\n      if (e && e.dmxMasonry) return;\r\n\r\n      const cb = () => {\r\n        fn.apply(this, arguments);\r\n      };\r\n\r\n      if (delay) {\r\n        clearTimeout(handle);\r\n        handle = setTimeout(cb, delay);\r\n      } else {\r\n        cancelAnimationFrame(handle);\r\n        handle = requestAnimationFrame(cb);\r\n      }\r\n    };\r\n  },\r\n\r\n  _reflow (e) {\r\n    //if (e && e.dmxMasonry) return;\r\n    if (!this.children.length) return;\r\n\r\n    this.$node.querySelectorAll('img').forEach(img => {\r\n      if (!img.dmxMasonry) {\r\n        img.addEventListener('load', this._reflow, { once: true });\r\n        if (img.src) img.src = img.src;\r\n        img.dmxMasonry = true;\r\n      }\r\n    });\r\n\r\n    let { breakpoints, columns, gutter } = this.props;\r\n    breakpoints = Object.assign({}, this._breakpoints, breakpoints);\r\n\r\n    ['sm', 'md', 'lg', 'xl', 'xxl'].forEach(breakpoint => {\r\n      if (window.innerWidth >= breakpoints[breakpoint]) {\r\n        const suffix = breakpoint[0].toUpperCase() + breakpoint.slice(1);\r\n        columns = this.props['columns' + suffix] || columns;\r\n        gutter = this.props['gutter' + suffix] || gutter;\r\n      }\r\n    });\r\n\r\n    const nodes = Array.from(this.$node.children);\r\n    const style = window.getComputedStyle(this.$node);\r\n    const padding = {\r\n      left: parseInt(style.paddingLeft) || 0,\r\n      right: parseInt(style.paddingRight) || 0,\r\n    };\r\n    const columnWidth = Math.floor((this.$node.clientWidth - padding.left - padding.right - ((columns - 1) * gutter)) / columns);\r\n\r\n    for (const node of nodes) {\r\n      node.style.setProperty('box-sizing', 'border-box');\r\n      node.style.setProperty('width', columnWidth + 'px');\r\n    }\r\n\r\n    // dispatch resize event for components that still listen to that for updating\r\n    const event = new Event('resize');\r\n    event.dmxMasonry = true;\r\n    window.dispatchEvent(event);\r\n\r\n    const columnHeights = Array(columns).fill(0);\r\n    const nodesHeights = nodes.map(node => node.clientHeight);\r\n\r\n    nodes.forEach((node, index) => {\r\n      const i = this.props.preserveOrder ? index % columns : columnHeights.indexOf(Math.min.apply(Math, columnHeights));\r\n      const x = (i * columnWidth) + (i * gutter);\r\n      const y = columnHeights[i];\r\n\r\n      node.style.setProperty('transform', `translate3d(${x}px, ${y}px, 0px)`);\r\n\r\n      if (nodesHeights[index]) {\r\n        if (!node.dmxMasonryInit) {\r\n          node.style.setProperty('position', 'absolute');\r\n\r\n          if (this.props.animated) {\r\n            node.style.setProperty('transition', `transform ${this.props.animationDuration}ms`);\r\n          }\r\n\r\n          requestAnimationFrame(() => node.style.setProperty('visibility', 'visible'));\r\n\r\n          node.dmxMasonryInit = true;\r\n\r\n          this._resizeObserver.observe(node);\r\n        }\r\n\r\n        columnHeights[i] += nodesHeights[index] + gutter;\r\n      }\r\n    });\r\n\r\n    this.$node.style.setProperty('height', (Math.max.apply(Math, columnHeights) - gutter) + 'px');\r\n  },\r\n\r\n});\r\n"]}